#!/usr/bin/env perl
use strict;
use warnings;
use Net::Plurk::Dumper;
no warnings "all";


use Getopt::Long;
my ( $plurk_id , $export_type );
GetOptions( 
    'id=s' => \$plurk_id ,
    'export=s' => \$export_type
);

unless ( $plurk_id ) {
    print <<END
    Usage:  
        perl -Ilib bin/export-plurk --id=your_plurk_id --export=xml|text|json

END
}

binmode STDOUT,":utf8";

my $p = Net::Plurk::Dumper->new( id => $plurk_id );
my $plurks = $p->fetch_plurks;

print "get " , scalar( @$plurks ) , " items \n";

for my $plurk ( @$plurks ) {

    print $plurk->{content_raw} . "\n";

    my $plurk_res = $p->fetch_plurk_responses( $plurk->{plurk_id} );
    my $friends = $plurk_res->{friends};

    for my $response ( @{ $plurk_res->{responses} }  ) {

        print " " x 4;
        # print $friends->{  $response->{user_id}  }->{display_name};
        print $friends->{  $response->{user_id}  }->{nick_name};
        print ": ";
        print $response->{content_raw} . "\n";

    }
}





